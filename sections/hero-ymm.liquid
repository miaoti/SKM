{{ 'ymm.css' | asset_url | stylesheet_tag }}

<div class="hero-ymm-section relative h-screen w-full overflow-hidden" data-section-id="{{ section.id }}">
  {%- comment -%} BACKDROP: Video or Image from Shopify settings {%- endcomment -%}
  {%- if section.settings.video != blank -%}
    <div class="absolute inset-0 z-0 hero-backdrop" id="hero-backdrop-{{ section.id }}">
      {{ section.settings.video | video_tag: autoplay: true, loop: true, muted: true, controls: false, class: "w-full h-full object-cover transition-all duration-700" }}
      <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/40 to-black/80"></div>
    </div>
  {%- elsif section.settings.background_image != blank -%}
    <div class="absolute inset-0 z-0 hero-backdrop" id="hero-backdrop-{{ section.id }}">
      {{ section.settings.background_image | image_url: width: 2000 | image_tag: class: "w-full h-full object-cover transition-all duration-700" }}
      <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/40 to-black/80"></div>
    </div>
  {%- else -%}
    <div class="absolute inset-0 z-0 bg-gradient-to-b from-gray-900 to-black"></div>
  {%- endif -%}

  {%- comment -%} HUD Scanline Overlay {%- endcomment -%}
  <div class="hud-scanline"></div>

  {%- liquid
    assign sf_token = section.settings.storefront_access_token | default: 'c9e546201d3f991f9c3f576e0d1cf4ee'
    assign collection_handle = section.settings.collection_handle | default: 'all'
    assign unique_id = 'hero-' | append: section.id
  -%}

  <div class="relative z-10 flex flex-col items-center justify-center h-full px-4 text-center">
    
    {%- comment -%} Configuration Warning {%- endcomment -%}
    {% if sf_token == blank %}
      <div class="bg-red-500 text-white p-4 mb-4 rounded font-bold">
        ⚠️ CONFIGURATION REQUIRED: Please add a Storefront Access Token in the section settings.
      </div>
    {% endif %}

    {%- comment -%} MAIN HEADER: Thin weight, extra spacing {%- endcomment -%}
    <h1 class="hud-header text-4xl md:text-6xl lg:text-7xl text-white mb-4 leading-tight">
      {{ section.settings.heading | default: "ACOUSTIC ENGINEERING. REFINED." }}
    </h1>

    {%- comment -%} Subheading {%- endcomment -%}
    <p class="hud-mono text-gray-400 mb-12 tracking-widest text-xs">
      [ INITIALIZE VEHICLE DIAGNOSTIC SEQUENCE ]
    </p>

    {%- comment -%} =========================================
         DIAGNOSTIC BAR: YMM Interface
         Uses the original YMM functionality integrated with new styling
    ========================================== {%- endcomment -%}
    <div class="ymm-diagnostic-bar w-full max-w-6xl">
      <div class="diagnostic-container bg-black/80 backdrop-blur-md border border-white/10 p-6 md:p-8">
        
        {%- comment -%} Status Line {%- endcomment -%}
        <div class="flex items-center justify-between mb-6 pb-4 border-b border-white/5">
          <div class="hud-mono text-xs text-[#CC0000] tracking-widest">VEHICLE IDENTIFICATION</div>
          <div class="flex items-center gap-2">
            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
            <span class="hud-mono text-green-500 text-[10px]">ONLINE</span>
          </div>
        </div>

        {%- comment -%} YMM Input Grid - Using inline CSS Grid for button on right {%- endcomment -%}
        <div class="ymm-search-grid w-full" style="display: grid; grid-template-columns: 1fr auto; gap: 1.5rem; align-items: end;">
          
          
          {%- comment -%} LEFT: Input Fields Group - flex:1 for auto-sizing {%- endcomment -%}
          <div style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end; flex: 1;">
            
            {%- comment -%} YEAR {%- endcomment -%}
            <div class="ymm-search-field" style="flex: 1; min-width: 120px;">
              <label class="hud-mono text-[10px] text-gray-500 block mb-2 tracking-widest">YEAR:</label>
              <div class="relative">
                <select id="ymm-year-{{ unique_id }}" data-role="ymm-year" class="diagnostic-select w-full">
                  <option value="">Select</option>
                </select>
              </div>
            </div>

            {%- comment -%} MAKE {%- endcomment -%}
            <div class="ymm-search-field" style="flex: 1; min-width: 130px;">
              <label class="hud-mono text-[10px] text-gray-500 block mb-2 tracking-widest">MAKE:</label>
              <div class="relative">
                <select id="ymm-make-{{ unique_id }}" data-role="ymm-make" disabled class="diagnostic-select w-full">
                  <option value="">Select</option>
                </select>
              </div>
            </div>

            {%- comment -%} MODEL {%- endcomment -%}
            <div class="ymm-search-field" style="flex: 1; min-width: 150px;">
              <label class="hud-mono text-[10px] text-gray-500 block mb-2 tracking-widest">MODEL:</label>
              <div class="relative">
                <select id="ymm-model-{{ unique_id }}" data-role="ymm-model" disabled class="diagnostic-select w-full">
                  <option value="">Select</option>
                </select>
              </div>
            </div>

            {%- comment -%} SUBMODEL (Controlled by ymm.js) {%- endcomment -%}
            <div class="ymm-search-field" data-role="ymm-submodel-container" id="submodel-container-{{ unique_id }}" style="flex: 1; min-width: 130px; display: none;">
              <label class="hud-mono text-[10px] text-gray-500 block mb-2 tracking-widest">SUBMODEL:</label>
              <div class="relative">
                <select id="ymm-submodel-{{ unique_id }}" data-role="ymm-submodel" disabled class="diagnostic-select w-full">
                  <option value="">Select</option>
                </select>
              </div>
            </div>
          </div>

          {%- comment -%} RIGHT: Search Button (always on right via grid) {%- endcomment -%}
          <div class="ymm-search-field w-full md:w-auto md:justify-self-end">
            <button type="button" data-role="ymm-submit" class="group w-full md:w-auto px-8 h-[46px] bg-transparent border-2 border-white/50 text-white font-bold uppercase tracking-widest text-xs hover:bg-[#CC0000] hover:border-[#CC0000] transition-all duration-300 flex items-center justify-center gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="opacity-70 group-hover:opacity-100">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
              </svg>
              <span>Search</span>
            </button>
          </div>
        </div>

        {%- comment -%} Status Output {%- endcomment -%}
        <div class="ymm-status mt-6 pt-4 border-t border-white/5 hud-mono text-[10px] text-gray-600 text-center" aria-live="polite">
        </div>
      </div>
    </div>

    {%- comment -%} Scroll Indicator {%- endcomment -%}
    <div class="absolute bottom-8 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 animate-bounce opacity-50">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" class="text-white">
        <path d="M12 5v14M5 12l7 7 7-7"/>
      </svg>
    </div>
  </div>

  {%- comment -%} YMM Configuration - MUST be inside the data-section-id element {%- endcomment -%}
  <script type="application/json" id="ymm-config-{{ unique_id }}">
    {
      "collectionHandle": {{ collection_handle | json }},
      "showSubmodel": true,
      "showEngine": false,
      "storefrontAccessToken": {{ sf_token | json }},
      "apiVersion": "2025-01",
      "rootId": {{ unique_id | json }}
    }
  </script>
</div>

{%- comment -%} Background blur effect on selection {%- endcomment -%}
<script>
  (function() {
    const backdrop = document.getElementById('hero-backdrop-{{ section.id }}');
    if (backdrop) {
      const selects = document.querySelectorAll('[data-role="ymm-year"], [data-role="ymm-make"], [data-role="ymm-model"], [data-role="ymm-submodel"]');
      selects.forEach(select => {
        select.addEventListener('change', function() {
          const media = backdrop.querySelector('video, img');
          if (media) {
            media.classList.add('blur-sm', 'scale-105');
            setTimeout(() => {
              media.classList.remove('blur-sm', 'scale-105');
            }, 600);
          }
        });
      });
    }
  })();
</script>

{%- comment -%} Load the original YMM JS {%- endcomment -%}
<script src="{{ 'ymm.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "Hero: Acoustic Command",
  "settings": [
    {
      "type": "video",
      "id": "video",
      "label": "Background Video"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image (Fallback)"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "ACOUSTIC ENGINEERING. REFINED."
    },
    {
      "type": "text",
      "id": "collection_handle",
      "label": "Destination Collection",
      "default": "all"
    },
    {
      "type": "text",
      "id": "storefront_access_token",
      "label": "Storefront Access Token",
      "default": "c9e546201d3f991f9c3f576e0d1cf4ee"
    }
  ],
  "presets": [
    {
      "name": "Hero: Acoustic Command"
    }
  ]
}
{% endschema %}
