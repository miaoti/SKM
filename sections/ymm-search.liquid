<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div class="section page-width-content color-{{ section.settings.color_scheme }}">
  <div
    class="
      spacing-style
      layout-panel-flex
      layout-panel-flex--column
      section-content-wrapper
      mobile-column
    "
    style="
      {% render 'layout-panel-style', settings: section.settings %}
      {% render 'spacing-style', settings: section.settings %}
    "
    data-section-id="{{ section.id }}"
    class="ymm-overlay"
  >
    <link rel="preload" as="style" href="{{ 'ymm.css' | asset_url }}">
    {{ 'ymm.css' | asset_url | stylesheet_tag }}
    <style>
      .ymm-title{font-size:clamp(28px,4vw,44px);line-height:1.1;margin:0}
      .ymm-controls{border-radius:16px;padding:24px}
    </style>
    <div class="ymm-header">
      {% if section.settings.heading != blank %}
        <h2 class="ymm-title">{{ section.settings.heading }}</h2>
      {% endif %}
      {% if section.settings.subheading != blank %}
        <p class="ymm-subtitle">{{ section.settings.subheading }}</p>
      {% endif %}
    </div>
    <div class="ymm-controls" data-collection-handle="{{ section.settings.collection_handle }}">
      <div class="ymm-row">
        <label for="ymm-year">Year</label>
        <select id="ymm-year" data-role="ymm-year" aria-describedby="ymm-status"></select>
      </div>
      <div class="ymm-row">
        <label for="ymm-make">Make</label>
        <select id="ymm-make" data-role="ymm-make" aria-describedby="ymm-status" disabled></select>
      </div>
      <div class="ymm-row">
        <label for="ymm-model">Model</label>
        <select id="ymm-model" data-role="ymm-model" aria-describedby="ymm-status" disabled></select>
      </div>
      {% if section.settings.show_submodel %}
        <div class="ymm-row" data-role="ymm-submodel-container">
          <label for="ymm-submodel">Submodel</label>
          <select id="ymm-submodel" data-role="ymm-submodel" aria-describedby="ymm-status" disabled></select>
        </div>
      {% endif %}
      {% if section.settings.show_engine %}
        <div class="ymm-row">
          <label for="ymm-engine">Engine</label>
          <select id="ymm-engine" data-role="ymm-engine" aria-describedby="ymm-status" disabled></select>
        </div>
      {% endif %}
      <div class="ymm-actions">
        <button type="button" class="ymm-submit" data-role="ymm-submit">BUILD YOUR SETUP</button>
      </div>
      <div class="ymm-status" id="ymm-status" aria-live="polite"></div>
    </div>
    <script type="application/json" id="ymm-config-{{ section.id }}">
      {
        "collectionHandle": {{ section.settings.collection_handle | json }},
        "showSubmodel": {{ section.settings.show_submodel | json }},
        "showEngine": {{ section.settings.show_engine | json }},
        "storefrontAccessToken": {{ section.settings.storefront_access_token | json }},
        "apiVersion": "2025-01"
      }
    </script>
    <script src="{{ 'ymm.js' | asset_url }}" defer="defer"></script>
  </div>
</div>

{% schema %}
{
  "name": "YMM Search",
  "class": "section-wrapper",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Find Exhausts for Your Vehicle"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Premium performance, engineered fitment."
    },
    {
      "type": "text",
      "id": "collection_handle",
      "label": "Destination collection handle",
      "default": "all"
    },
    {
      "type": "checkbox",
      "id": "show_submodel",
      "label": "Include Submodel",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_engine",
      "label": "Include Engine",
      "default": false
    },
    {
      "type": "text",
      "id": "storefront_access_token",
      "label": "Storefront API access token",
      "info": "Required to query vehicle metaobjects via Storefront API."
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    }
  ],
  "enabled_on": {
    "templates": ["page", "index"]
  }
}
{% endschema %}
